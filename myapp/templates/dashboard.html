{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Dashboard - Diabetes Predictor{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Analytics Dashboard</h1>
        <p class="text-gray-600">Overview of all predictions and health metrics</p>
    </div>

    <!-- Stats Grid -->
    <div class="grid md:grid-cols-4 gap-6 mb-8">
        <!-- Total Predictions -->
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-200">
            <div class="flex items-center justify-between mb-4">
                <i class="fas fa-chart-line text-4xl opacity-80"></i>
                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">Total</span>
            </div>
            <div class="text-4xl font-bold mb-1">{{ stats.total }}</div>
            <div class="text-blue-100">Total Predictions</div>
        </div>

        <!-- Positive Cases -->
        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-200">
            <div class="flex items-center justify-between mb-4">
                <i class="fas fa-exclamation-triangle text-4xl opacity-80"></i>
                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">Risk</span>
            </div>
            <div class="text-4xl font-bold mb-1">{{ stats.positive }}</div>
            <div class="text-red-100">Diabetes Risk Detected</div>
        </div>

        <!-- Negative Cases -->
        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-200">
            <div class="flex items-center justify-between mb-4">
                <i class="fas fa-check-circle text-4xl opacity-80"></i>
                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">Healthy</span>
            </div>
            <div class="text-4xl font-bold mb-1">{{ stats.negative }}</div>
            <div class="text-green-100">Low Risk Cases</div>
        </div>

        <!-- Risk Percentage -->
        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-200">
            <div class="flex items-center justify-between mb-4">
                <i class="fas fa-percentage text-4xl opacity-80"></i>
                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">Rate</span>
            </div>
            <div class="text-4xl font-bold mb-1">
                {% if stats.total > 0 %}
                    {{ stats.positive|floatformat:0|add:"0"|mul:100|div:stats.total|floatformat:1 }}%
                {% else %}
                    0%
                {% endif %}
            </div>
            <div class="text-purple-100">Risk Detection Rate</div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid md:grid-cols-2 gap-6 mb-8">
        <!-- Distribution Chart -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-pie text-indigo-600 mr-2"></i>
                Prediction Distribution
            </h3>
            <div class="flex items-center justify-center h-64">
                <div class="relative w-48 h-48">
                    <svg viewBox="0 0 100 100" class="transform -rotate-90">
                        {% if stats.total > 0 %}
                        {% with positive_percent=stats.positive|floatformat:0|add:"0"|mul:100|div:stats.total %}
                        <circle cx="50" cy="50" r="40" fill="none" stroke="#e5e7eb" stroke-width="20"/>
                        <circle cx="50" cy="50" r="40" fill="none" stroke="#ef4444" stroke-width="20"
                                stroke-dasharray="{{ positive_percent }} {{ 100|add:"-"|add:positive_percent }}"
                                stroke-linecap="round"/>
                        {% endwith %}
                        {% else %}
                        <circle cx="50" cy="50" r="40" fill="none" stroke="#e5e7eb" stroke-width="20"/>
                        {% endif %}
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-900">{{ stats.total }}</div>
                            <div class="text-sm text-gray-500">Total</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-center gap-6 mt-4">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-red-500 rounded mr-2"></div>
                    <span class="text-sm text-gray-600">Risk: {{ stats.positive }}</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-gray-300 rounded mr-2"></div>
                    <span class="text-sm text-gray-600">Healthy: {{ stats.negative }}</span>
                </div>
            </div>
        </div>

        <!-- Average Metrics -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-bar text-indigo-600 mr-2"></i>
                Average Health Metrics
            </h3>
            <div class="space-y-4">
                <!-- Average Glucose -->
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Average Glucose</span>
                        <span class="text-sm font-bold text-gray-900">{{ stats.avg_glucose }} mg/dL</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-green-400 to-red-500 h-3 rounded-full" 
                             style="width: {% if stats.avg_glucose > 0 %}{{ stats.avg_glucose|floatformat:0|add:"0"|mul:100|div:200 }}%{% else %}0%{% endif %}"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0</span>
                        <span>Normal: 70-140</span>
                        <span>200</span>
                    </div>
                </div>

                <!-- Average BMI -->
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Average BMI</span>
                        <span class="text-sm font-bold text-gray-900">{{ stats.avg_bmi }} kg/mÂ²</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-blue-400 to-purple-500 h-3 rounded-full" 
                             style="width: {% if stats.avg_bmi > 0 %}{{ stats.avg_bmi|floatformat:0|add:"0"|mul:100|div:50 }}%{% else %}0%{% endif %}"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0</span>
                        <span>Normal: 18.5-24.9</span>
                        <span>50</span>
                    </div>
                </div>

                <!-- Health Status -->
                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4 mt-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm text-gray-600 mb-1">Overall Health Status</div>
                            <div class="text-2xl font-bold text-indigo-600">
                                {% if stats.avg_glucose < 140 and stats.avg_bmi < 30 %}
                                    Excellent
                                {% elif stats.avg_glucose < 160 and stats.avg_bmi < 35 %}
                                    Good
                                {% else %}
                                    Needs Attention
                                {% endif %}
                            </div>
                        </div>
                        <i class="fas fa-heart text-4xl text-indigo-600"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-bolt text-indigo-600 mr-2"></i>
            Quick Actions
        </h3>
        <div class="grid md:grid-cols-3 gap-4">
            <a href="{% url 'predict' %}" class="flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-lg font-semibold hover:shadow-xl transform hover:-translate-y-1 transition duration-200">
                <i class="fas fa-plus-circle mr-2"></i> New Prediction
            </a>
            <a href="{% url 'history' %}" class="flex items-center justify-center bg-gradient-to-r from-blue-600 to-cyan-600 text-white py-4 rounded-lg font-semibold hover:shadow-xl transform hover:-translate-y-1 transition duration-200">
                <i class="fas fa-history mr-2"></i> View History
            </a>
            <button onclick="window.print()" class="flex items-center justify-center bg-gradient-to-r from-gray-600 to-gray-700 text-white py-4 rounded-lg font-semibold hover:shadow-xl transform hover:-translate-y-1 transition duration-200">
                <i class="fas fa-print mr-2"></i> Print Report
            </button>
        </div>
    </div>

    <!-- Info Banner -->
    {% if stats.total == 0 %}
    <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-lg p-6 mt-8">
        <div class="flex items-center">
            <i class="fas fa-info-circle text-2xl text-yellow-600 mr-4"></i>
            <div>
                <h3 class="font-bold text-yellow-900 mb-1">No Data Available</h3>
                <p class="text-yellow-800 text-sm">Start by making your first prediction to see analytics here.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
// Custom template filters simulation
document.addEventListener('DOMContentLoaded', function() {
    // Add any interactive features here
});
</script>
{% endblock %}
